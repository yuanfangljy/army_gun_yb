<html>
<head>
    <!--<meta http-equiv="refresh" content="3">-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <style type="text/css">
        body, html, #allmap {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
            font-family: "微软雅黑";
        }

        .tag:before, .tag:after {
            content: "";
            display: block;
            border-width: 10px;
            position: absolute;
            bottom: -20px;
            left: 60px;
            border-style: solid dashed dashed;
            border-color: #ccc transparent transparent;
        }

        .tag:after {
            bottom: -19px;
            border-color: #FFF transparent transparent;
        }
    </style>
    <link rel="icon" href="../../favicon.ico">
    <title>Dashboard Template for Bootstrap</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/ie10-viewport-bug-workaround.css" rel="stylesheet">
    <link href="css/dashboard.css" rel="stylesheet">
    <link href="css/index.css" rel="stylesheet" type="text/css"/>
    <script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="js/jquery.js"></script>
    <script src="js/ie-emulation-modes-warning.js"></script>
    <script type="text/javascript"
            src="http://api.map.baidu.com/api?v=2.0&ak=txyCbKTm1TbFwqyT90iB1t9YLiUY9ZG6"></script>
    <title>百度地图</title>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid" style="background-color:#022581">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <img src="img/logo.png" width="36" height="36" style=" float:left; margin-top:6px; margin-right:6px">
            <a class="navbar-brand" href="#">枪械定位追踪</a>
        </div>
        <div id="navba	r" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#">设置</a></li>
                <li><a href="#">admin</a></li>
            </ul>
            <div class="navbar-form navbar-right">
                <input type="text" id="deviceNos" name="deviceNos" class="form-control" placeholder="搜索">
            </div>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-xs-3 col-md-1 sidebar" style=" padding-top:0px; padding-bottom:0px; background-color:#004892;">
            <ul class="nav nav-sidebar">
                <li class="activb"><a href="map.html" style=" border-bottom:1px solid #053e78; line-height:38px;"><img
                        src="img/guangli.png" style="padding-right:20px;">枪支管理</a></li>
                <li><a href="storage.html" style=" border-bottom:1px solid #053e78; line-height:38px;"><img
                        src="img/ruku.png" style="padding-right:20px;">枪支入库</a></li>
                <li><a href="delivery.html" style=" border-bottom:1px solid #053e78; line-height:38px;"><img
                        src="img/chuku.png" style="padding-right:20px;">枪支出库</a></li>
                <li><a href="index.html" style=" border-bottom:1px solid #053e78; line-height:38px;"><img
                        src="img/diaoku.png" style="padding-right:20px;">枪支列表</a></li>
                <li><a href="trajectory.html" style=" border-bottom:1px solid #053e78; line-height:38px;"><img
                        src="img/guiji.png" style="padding-right:20px;">枪支轨迹</a></li>
                <li><a href="llibrary.html" style=" border-bottom:1px solid #053e78; line-height:38px;"><img
                        src="img/kushi.png" style="padding-right:20px;">库室管理</a></li>
                <li><a href="warning.html" style=" border-bottom:1px solid #053e78; line-height:38px;"><img
                        src="img/jingao.png" style="padding-right:20px;">警告信息</a></li>
            </ul>
        </div>
    </div>
</div>
<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main"
     style="margin-left:11.8%; width:89.4%; margin-top:2px;">

    <!--地图-->
    <div id="allmap"></div>

</div>

<div class="news" id="news">
    <div class="offlines" style="margin-top:16px; margin-left:25px;">
        <img src="img/lixian.png" style="float:left; margin-top:-5px;">
        <dl style="color:#fa1267; float:left; margin-left:16px; margin-top:-15px; padding-right:20px; border-right:1px solid rgba(255,255,255,0.70)">
            <dd><span id="offline" style="font-size:28px"></span>个</dd>
            <dd>离线设备数</dd>
        </dl>
    </div>
    <div class="dislocations" style=" float:left; padding-left:25px;">
        <img src="img/liwei.png" style="float:left; margin-top:-5px;">
        <dl style="color:#2db5ee; float:left; margin-left:16px; margin-top:-15px">
            <dd><span id="dislocation" style="font-size:28px"></span>个</dd>
            <dd>离位枪支数</dd>
        </dl>
    </div>
</div>
<!--枪支离位列表-->
<div class="state" id="showTableGun" style=" background-color:rgba(26,26,26,0.9); border:none; display:none;">
    <table class="table table-condensed" id="gunTag_OffNormal_table"  style="width:340px; margin-left:8px; margin-top:-10px;">
        <button type="button" id="close2" style="color: #ffffff" class="close" data-dismiss="model" aria-hidden="true">&times</button>
        <h4 class="modal-title text-center" style="color:rgba(255,255,255,1); margin-top: 10px;margin-bottom:20px;">枪支离位列表</h4>
        <thead>
        <tr style="color:#e5e5e5; font-size:14PX; background-color:rgba(36,36,36,0.9);">
            <th class="text-center">警员编号</th>
            <th class="text-center">枪支</th>
            <th class="text-center">枪号</th>
            <th class="text-center">操作</th>
            <!--<th class="text-center">状态</th>-->
        </tr>
        </thead>
        <tbody style="color:#f5f5f5; text-align:center; background-color:rgba(46,46,46,0.9);">
        </tbody>
    </table>
    <div  style="position:absolute;margin-top: -10px; margin-left:70px">

        <!--分页文字信息 -->
        <div class=" ">
        </div>
        <!-- 分页条-->
        <div class="" id="page_nav_gun">
        </div>
    </div>
</div>


<!--设备离线列表-->
<div class="state" id="showTableDevice" style=" background-color:rgba(26,26,26,0.9); border:none; display:none;" aria-labelledby="myModalLabel">
    <table class="table table-condensed" id="gunTag_OffLine_table" style="width:340px; margin-left:8px; margin-top:-10px;">
        <button type="button" id="close1" class="close" style="color: #ffffff" data-dismiss="state" aria-hidden="true">&times</button>
        <h4 class="modal-title text-center" id="myModalLabel" style="color:rgba(255,255,255,1); margin-top: 10px;margin-bottom: 20px;">警员离线列表</h4>

        <thead >
        <tr style="color:#e5e5e5; font-size:14PX; background-color:rgba(36,36,36,0.9);">
            <th class="text-center">警员编号</th>
            <th class="text-center">姓名</th>
            <th class="text-center">电话</th>
            <th class="text-center">操作</th>
        </tr>
        </thead>
        <tbody style="color:#f5f5f5; text-align:center; background-color:rgba(46,46,46,0.9);">
        </tbody>
    </table>
    <div  style="position:absolute;margin-top: -10px; margin-left:70px">

    <!--   分页文字信息-->
        <div class=" ">
        </div>
        <!--分页条-->
        <div class="" id="page_nav_area">
        </div>
    </div>
    <div/>
<!--<div class="state" id="showTableDevice" style="display:none" aria-labelledby="myModalLabel">
    <table class="table table-striped" id="gunTag_OffLine_table">
        <button type="button" id="close1" class="close" data-dismiss="state" aria-hidden="true">&times</button>
        <h4 class="modal-title text-center" id="myModalLabel">警员离线列表</h4>
        &lt;!&ndash;<span style="position: absolute;right: 0px;">×</span>&ndash;&gt;
        <thead>
        <tr style="color: #616161">
            <th class="text-center">警员编号</th>
            <th class="text-center">姓名</th>
            <th class="text-center">电话</th>
            <th class="text-center">操作</th>
            &lt;!&ndash; <th class="text-center">状态</th>&ndash;&gt;
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <div  style="margin-top: -10px; margin-left: -220px">

        &lt;!&ndash;分页文字信息 &ndash;&gt;
        <div class="col-md-6 ">
        </div>
        &lt;!&ndash; 分页条&ndash;&gt;
        <div class="col-md-6" id="page_nav_area">
        </div>
    </div>
<div/>
-->


    <script src="layui/layui.all.js" type="text/javascript"></script>
    <script src="js/holder.min.js"></script>
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/ie10-viewport-bug-workaround.js"></script>
    <script type="text/javascript" src="js/ditu/MarkerClusterer.js"></script>
    <script type="text/javascript"
            src="http://api.map.baidu.com/library/TextIconOverlay/1.2/src/TextIconOverlay_min.js"></script>
    <script type="text/javascript" src="js/mq/stomp.min.js"></script>
    <script type="text/javascript" src="js/mq/sockjs.min.js"></script>
    <script type="text/javascript" src="js/mq/customer.js"></script>
    <script >
        var differentindex;
        $(function () {
            //隐藏或者显示列表
            $(".dislocations").hover(function () {
                gunOffNormal();
                $("#showTableGun").toggle();
                $("#showTableDevice").hide();
            }, function () {
                layer.close(differentindex);
            });
            $(".offlines").hover(function () {
                gunOffLine();
                $("#showTableDevice").toggle();
                $("#showTableGun").hide();
            }, function () {
                layer.close(differentindex);
            });
           /* $("div").not("div.state *").click(function(){
                // 点击body时 隐藏 div
                $("#showTableGun").hide();
                $("#showTableDevice").hide();
            });*/
            //枪支离位列表
            /*deviceLocation(null);
            deviceDislocation();
            gunDislocation();*/
        })
        function dingshi(){
//枪支离位列表
            deviceLocation(null);
            deviceDislocation();
            gunDislocation();
           // gunOffNormal(1) ;
           // gunOffLine(1);
        }
       setInterval(dingshi, 1000);
    </script>
</body>
</html>
<script type="text/javascript">

    // 百度地图API功能
    var map = new BMap.Map("allmap");
    var point = new BMap.Point(114.034656, 22.616798);
    map.centerAndZoom(point, 5);
    //1、设置地图的样式
    //map.setMapStyle({style:'midnight'});
    //2、设置地图默认的鼠标指针样式
    map.setDefaultCursor("url('bird.cur')");
    //3、启用滚轮放大缩小，默认禁用
    map.enableScrollWheelZoom();
    //4、启用地图惯性拖拽，默认禁用
    map.enableContinuousZoom();
    //5、进行拖拽
    map.enableScrollWheelZoom(true);
    map.disableDragging();     //禁止拖拽

    setTimeout(function () {
        map.enableDragging();   //两秒后开启拖拽
        map.enableInertialDragging();   //两秒后开启惯性拖拽
    }, 2000);
    //设置地图
    map.addControl(new BMap.MapTypeControl({
        mapTypes: BMAP_HYBRID_MAP
        /* [
         BMAP_HYBRID_MAP,
         BMAP_NORMAL_MAP
         //BMAP_SATELLITE_MAP//卫星地图
     ]*/
    }));
    //设置地图：使用混合地图
    map.setMapType(BMAP_SATELLITE_MAP);
    //6、 添加带有定位的导航控件
    var navigationControl = new BMap.NavigationControl({
        // 靠左上角位置
        anchor: BMAP_ANCHOR_TOP_LEFT,
        // LARGE类型
        type: BMAP_NAVIGATION_CONTROL_LARGE,
        // 启用显示定位
        enableGeolocation: true
    });
    map.addControl(navigationControl);

    // 添加定位控件
    var geolocationControl = new BMap.GeolocationControl();
    geolocationControl.addEventListener("locationSuccess", function (e) {
        // 定位成功事件
        var address = '';
        address += e.addressComponent.province;
        address += e.addressComponent.city;
        address += e.addressComponent.district;
        address += e.addressComponent.street;
        address += e.addressComponent.streetNumber;
        layer.alert("当前定位地址为：" + address);
    });
    geolocationControl.addEventListener("locationError", function (e) {
        // 定位失败事件
        layer.alert(e.message);
    });
    map.addControl(geolocationControl);

    //6、左下角地图查看空间
    var overviewControl1 = new BMap.OverviewMapControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,isOpen:true});
    map.addControl(overviewControl1);

    //7、添加标注
    function deviceLocation(deviceNos) {
        var label = [];//保存日期
        var value = [];//数量
        var markers = [];//点聚合参数
        var markerClusterer = null;//点聚合参数
        //设备实时状态显示
        $.ajax({
            url: "../deviceGun/realTimeDeviceAndGun",
            type: "GET",
            data: {"deviceNo": deviceNos},
            dataType: "json",
            asynec:true,
            success: function (result) {
                $.each(result.extend.devices, function (i, p) {
                    label[i] = p.deviceLocationLongitude;
                    value[i] = p.deviceLocationLatirude;
                    // 7.1:创建点
                    var myIcon;
                    if(p.gunState==0 && p.deviceState==0){
                         myIcon = new BMap.Icon('img/normalGun.png', new BMap.Size(68, 75));//这里先不用第三个参数IconOptions
                    }else{
                         myIcon = new BMap.Icon('img/offNormalGun.png', new BMap.Size(68, 75));//这里先不用第三个参数IconOptions
                    }

                    //这就是对象的字面量形式
                    var marker = new BMap.Marker(new BMap.Point(label[i], value[i]), {icon: myIcon});
                    //将标注添加到地图中
                    map.addOverlay(marker);
                    addClickHandler(marker);

                    //marker.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画
                    function addClickHandler(marker) {
                        marker.addEventListener("click", function (e) {
                            //var markers = new BMap.Point(113.213676, 29.373501);
                            deviceLocation(p.deviceNo);
                            }
                        );
                    }

                    <!--框-->
                    var gunOffNormal = '<span style=" background:url(img/red.png); background-repeat:no-repeat; background-position:left; padding-left: 16px; margin-right: 22px">离位</span>';
                    var unused = '<span style=" background:url(img/red.png); background-repeat:no-repeat; background-position:left; padding-left: 16px; margin-right: 22px">未使用</span>';
                    var accompany = '<span style=" background:url(img/green.png); background-repeat:no-repeat; background-position:left; padding-left: 16px; margin-right: 22px" >随行</span>';
                    var onLine = '<span style=" background:url(img/green.png); background-repeat:no-repeat; background-position:left; padding-left: 16px; margin-right: 22px">在线</span>';
                    var offLine = '<span style=" background:url(img/red.png); background-repeat:no-repeat; background-position:left; padding-left: 16px; margin-right: 22px">离线</span>';
                    var assist = '<span style=" background:url(img/orange.png); background-repeat:no-repeat; background-position:left; padding-left: 16px; margin-right: 22px">协助</span>';

                    var tag;//标签
                    if(p.gunState==0 && p.deviceState==0){
                         tag = "<div class='tag' style='padding-left:10px;padding-top:6px;line-height:20px;width:150px; height:120px; border:1px solid #ccc; position:relative; border-radius:8px; background-color:#FFF;'>"
                            + "警员编号：" + p.deviceNo + "</br>"
                            + "枪号：" + p.gunTag + "</br>"
                            + "枪支：" + p.gunModel + "</br>"
                            + "电话：" + p.mobile + "</br>"
                            + ((p.gunState) == 0 ? accompany : (p.gunState) == 1 ? unused : gunOffNormal)
                            + ((p.deviceState) == 0 ? onLine : (p.deviceState) == 1 ? unused : (p.deviceState) == 2 ? offLine : assist) + "</br>"+"</div>";
                    }else{
                         tag = "<div class='tag2' style='padding-left:10px;padding-top:6px;line-height:20px;width:150px; height:120px; border:1px solid #f8b400; position:relative; border-radius:8px; background-color:#f8b400;'>"
                            + "警员编号：" + p.deviceNo + "</br>"
                            + "枪号：" + p.gunTag + "</br>"
                            + "枪支：" + p.gunModel + "</br>"
                            + "电话：" + p.mobile + "</br>"
                            + ((p.gunState) == 0 ? accompany : (p.gunState) == 1 ? unused : gunOffNormal)
                            + ((p.deviceState) == 0 ? onLine : (p.deviceState) == 1 ? unused : (p.deviceState) == 2 ? offLine : assist) + "</br>"+"</div>";
                    }

                       /* " +<button type='button' onclick='FindAssist()' id='findAssist' class='btn btn-primary btn-sm' style='margin-top: 6px; margin-left: 25px;font-size: 14px;padding-top: 6px;'>前去查找</button>"*/ +


                    //创建标注的hover事件
                    marker.addEventListener("mouseover", function (e) {
                        //7.2 添加字体
                        var labela = new BMap.Label(tag, {offset: new BMap.Size(-50, -130)});
                        labela.setStyle({
                            color: "#302e18",
                            width: "100%",
                            height: "100%",
                            fontSize: "14px",
                        });
                        marker.setLabel(labela);
                    });
                    marker.addEventListener("mouseout", function (e) {
                        var label = this.getLabel();
                        setTimeout(function () {
                            label.setContent("");//设置标签内容为空
                            label.setStyle({border: "none", width: "0px", padding: "0px"});//设置标签边框宽度为0
                        }, 2000);
                    });

                    //7.4 将经纬坐标划入地图
                    label[i] = new BMap.Point(label[i], value[i]);

                    //7.3 将坐标放入到点聚合中
                    markers.push(marker);
                    //marker.addEventListener("click", attribute);

                    //7.5 让所有点在视野范围内(**在做页面实时刷新的时候，不要加上这个，不然页面会一直跳**)
                    //map.setViewport(label);

                });
                //7.3 最简单的用法，生成一个marker数组，然后调用markerClusterer类即可。
                markerClusterer = new BMapLib.MarkerClusterer(map, {markers: markers});


                //获取覆盖物位置
                function attribute(e) {
                    var p = e.target;
                    //layer.alert("marker的位置是" + p.getPosition().lng + "," + p.getPosition().lat);
                }
            }, error: function (result) {
                if (result.responseText == "IsAjax") {
                    window.location.href = "login.html";
                    return false;
                }
            }
        });
    }


    

    //枪支离线数
    function deviceDislocation() {
        $.ajax({
            url: "../deviceGun/statisticsDeviceOffLine",
            type: "POST",
            asynec:true,
            dataType: "json",
            success: function (result) {
                $("#offline").text(result.extend.deviceDislocation);
            }, error: function (result) {
                if (result.responseText == "IsAjax") {
                    window.location.href = "login.html";
                    return false;
                }
            }
        })
    }

    //设备离位数
    function gunDislocation() {
        $.ajax({
            url: "../deviceGun/statisticsGunDislocation",
            type: "POST",
            asynec:true,
            dataType: "json",
            success: function (result) {
                $("#dislocation").text(result.extend.gunDislocation);
            }, error: function (result) {
                if (result.responseText == "IsAjax") {
                    window.location.href = "login.html";
                    return false;
                }
            }
        })
    }

    //回车查询事件
    $(document).keyup(function (event) {
        if (event.keyCode == 13) {
            deviceLocation($("#deviceNos").val())
        }
    });

    //***********************************  离位枪支列表  *************************************
    //定义全局变量，保存总记录数
    var totalRecord, currentPage;
    function gunOffNormal(pn) {
        $.ajax({
            url: "../gun/inquireGunOffNormal",
            type: "POST",
            data: {"pn": pn},
            asynec:true,
            dataType: "json",
            success: function (result) {

                if(result.extend.pageInfo.pages>="2") {
                    //1、解析屏显示枪支数据、
                    build_gun_table(result);
                    build_page_gun(result);
                }else {
                    //1、解析屏显示枪支数据、
                    build_gun_table(result);
                }
            }, error: function (result) {
                if (result.responseText == "IsAjax") {
                    window.location.href = "login.html";
                    return false;
                }
            }
        })
    }

    //遍历列表
    //1、解析屏显示枪支数据、
    function build_gun_table(result) {
//清空( empty() )tabel表格
        $("#gunTag_OffNormal_table tbody").empty();
//extend中有个方法pageInfo中一个list：所有的员工信息
        var emps = result.extend.pageInfo.list;
        var deivceNoGun=result.extend.deivceNoGun.split("@");
        $.each(emps, function (index, item) {
            var deviceNo = $("<td></td>").append(deivceNoGun[index]).addClass("text-center");
            var gunTaMmodel = $("<td></td>").append(item.gunModel).addClass("text-center");
            var gunTag = $("<td></td>").append(item.gunTag).addClass("text-center");
            var gunState = $("<td></td>").append((item.state) == 1 ? "未使用" : (item.gunState) == 0 ? "随行" : "离位").addClass("text-center");

            //edit_btn添加上的class标识
            var selectBtn = $("<button></button>").addClass("btn btn-primary btn-sm gun_btn")
                .append($("<span></span>")/*.addClass("glyphicon glyphicon-pencil  ")*/
                    .append("查询"));
            //查询按钮添加最新枪支轨道的Id
            selectBtn.attr("gun-location-id",deivceNoGun[index]);

            //将两个按钮追加到一个按钮中
            var btnTd = $("<td></td>").append(selectBtn).addClass("text-center");

            //append（追加）方法执行完成以后还是放回原来的元素
            $("<tr></tr>")
            //.append(deviceLocationId)
                .append(deviceNo)
                .append(gunTaMmodel)
                .append(gunTag)
                .append(selectBtn)
                /*.append(gunState)*/
                .appendTo("#gunTag_OffNormal_table tbody");
        });
    }
    //4、枪支解析显示分页条
    function build_page_gun(result) {
//清空分页条信息
        $("#page_nav_gun").empty();
        var ul = $("<ul></ul>").addClass("pagination");

//构建元素
        var firstPageLi = $("<li></li>").append($("<a></a>").append("首页").attr("href", "#"));
        var prePageLi = $("<li></li>").append($("<a></a>").append("&laquo;"));
        if (result.extend.pageInfo.hasPreviousPage == false) {
            firstPageLi.addClass("disabled");
            prePageLi.addClass("disabled");
        } else {
//为元素，添加点击翻页的事件
//第一页
            firstPageLi.click(function () {
                gunOffNormal(1);
            });
//前一页
            prePageLi.click(function () {
                gunOffNormal(result.extend.pageInfo.pageNum - 1);
            });
        }

        var nextPageLi = $("<li></li>").append($("<a></a>").append("&raquo;"));
        var lastPageLi = $("<li></li>").append($("<a></a>").append("末页").attr("href", "#"));

        if (result.extend.pageInfo.hasNextPage == false) {
            nextPageLi.addClass("disabled");
            lastPageLi.addClass("disabled");
        } else {
            //下一页
            nextPageLi.click(function () {
                gunOffNormal(result.extend.pageInfo.pageNum + 1);
            });
            //末页
            lastPageLi.click(function () {
                gunOffNormal(result.extend.pageInfo.pages);
            });
        }
//添加首页和前一页的提示
        ul.append(firstPageLi).append(prePageLi).append(nextPageLi).append(lastPageLi);
//遍历给ul中添加页码提示,12345
        $.each(result.extend.pageInfo.navigatepageNums,
            function (index, item) {

                var numLi = $("<li></li>").append($("<a></a>").append(item));
                if (result.extend.pageInfo.pageNum == item) {
                    numLi.addClass("active");
                }
                //绑定单击事件
                numLi.click(function () {
                    gunOffNormal(item);
                });
                ul.append(numLi);
            });
//添加下一页和末页的提示
        ul.append(nextPageLi).append(lastPageLi);
//ul加入到nav元素中
        var navEle = $("<nav></nav>").append(ul);
        navEle.appendTo("#page_nav_gun");
    }


 //***********************************  离线警员列表  *****************************************
    function gunOffLine(pn) {
        $.ajax({
            url: "../device/inquireDeviceOffLine",
            type: "POST",
            data: {"pn": pn,"state":2},
            asynec:false,
            dataType: "json",
            success: function (result) {

                if(result.extend.pageInfo.pages>="2") {
                    //1、解析屏显示枪支数据、
                    build_device_table(result);
                    build_page_nac(result);
                }else {
                    build_device_table(result);
                }
            }, error: function (result) {
                if (result.responseText == "IsAjax") {
                    window.location.href = "login.html";
                    return false;
                }
            }
        })
    }

    //遍历列表
    //1、解析屏显示警员数据、
    function build_device_table(result) {
//清空( empty() )tabel表格
        $("#gunTag_OffLine_table tbody").empty();
//extend中有个方法pageInfo中一个list：所有的员工信息
        var emps = result.extend.pageInfo.list;
        $.each(emps, function (index, item) {
            var deviceNo = $("<td></td>").append(item.deviceNo).addClass("text-center");
            var deviceName = $("<td></td>").append(item.deviceName).addClass("text-center");
            var phone = $("<td></td>").append(item.phone).addClass("text-center");
            var gunState = $("<td></td>").append((item.state) == 1 ? "未使用" : (item.gunState) == 0 ? "随行" : "离位").addClass("text-center");

            //edit_btn添加上的class标识
            var selectBtn = $("<button></button>").addClass("btn btn-primary btn-sm edit_btn text-center")
                .append($("<span></span>")/*.addClass("glyphicon glyphicon-pencil  ")*/
                    .append("查询"));
            //查询按钮添加最新枪支轨道的Id
            selectBtn.attr("device-location-id", item.deviceNo);

            //将两个按钮追加到一个按钮中
            var btnTd = $("<td></td>").append(selectBtn).addClass("text-center");

            //append（追加）方法执行完成以后还是放回原来的元素
            $("<tr></tr>")
            //.append(deviceLocationId)
                .append(deviceNo)
                .append(deviceName)
                .append(phone)
                .append(selectBtn)
                /*.append(gunState)*/
                .appendTo("#gunTag_OffLine_table tbody");
        });
    }


    //3、设备解析显示分页条
    function build_page_nac(result) {
//清空分页条信息
        $("#page_nav_area").empty();
        var ul = $("<ul></ul>").addClass("pagination");

//构建元素
        var firstPageLi = $("<li></li>").append($("<a></a>").append("首页").attr("href", "#"));
        var prePageLi = $("<li></li>").append($("<a></a>").append("&laquo;"));
        if (result.extend.pageInfo.hasPreviousPage == false) {
            firstPageLi.addClass("disabled");
            prePageLi.addClass("disabled");
        } else {
//为元素，添加点击翻页的事件
//第一页
            firstPageLi.click(function () {
                gunOffLine(1);
            });
//前一页
            prePageLi.click(function () {
                gunOffLine(result.extend.pageInfo.pageNum - 1);
            });
        }

        var nextPageLi = $("<li></li>").append($("<a></a>").append("&raquo;"));
        var lastPageLi = $("<li></li>").append($("<a></a>").append("末页").attr("href", "#"));

        if (result.extend.pageInfo.hasNextPage == false) {
            nextPageLi.addClass("disabled");
            lastPageLi.addClass("disabled");
        } else {
            //下一页
            nextPageLi.click(function () {
                gunOffLine(result.extend.pageInfo.pageNum + 1);
            });
            //末页
            lastPageLi.click(function () {
                gunOffLine(result.extend.pageInfo.pages);
            });
        }


//添加首页和前一页的提示
        ul.append(firstPageLi).append(prePageLi).append(nextPageLi).append(lastPageLi);
//遍历给ul中添加页码提示,12345
        $.each(result.extend.pageInfo.navigatepageNums,
            function (index, item) {

                var numLi = $("<li></li>").append($("<a></a>").append(item));
                if (result.extend.pageInfo.pageNum == item) {
                    numLi.addClass("active");
                }
                //绑定单击事件
                numLi.click(function () {
                    gunOffLine(item);
                });
                ul.append(numLi);
            });
//添加下一页和末页的提示
        ul.append(nextPageLi).append(lastPageLi);
//ul加入到nav元素中
        var navEle = $("<nav></nav>").append(ul);
        navEle.appendTo("#page_nav_area");
    }

//关闭列表
   $("#close1").click(function(){
        $("#showTableDevice").hide();
    })
    $("#close2").click(function(){
        $("#showTableGun").hide();
    })

    //地图模态框
    function FindAssist() {
        alert("11");
        $("#findGun").modal({
            backdrop:"static"
        });
    }

    //点击设备查询按钮
    $(document).on("click",".edit_btn",function () {
        //表示当前被点击的按钮
        var deviceNoId=$(this).attr("device-location-id");
        deviceLocation(deviceNoId);
    })

    //点击枪支查询按钮
    $(document).on("click",".gun_btn",function () {
        //表示当前被点击的按钮
        var deviceNoId=$(this).attr("gun-location-id");
        deviceLocation(deviceNoId);
    })


</script>
